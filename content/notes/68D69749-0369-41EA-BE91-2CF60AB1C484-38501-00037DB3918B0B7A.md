---
title: Build processes should only generate new files
updated_at: 2021-03-27 08:37:02.000000000 +01:00
tags:
- "#public"
---


Steps in a build process should not modify files—neither files that are checked-in into the version control system, nor files that were generated previously in the build process.

This is essentially side-effect-free programming. Writing to disk is not a _side_ effect; it is the main effect. Build step inputs and outputs are immutable.

There is one exception to this guideline: a build step can generate files and mutate them _in the same build step_. This works, because the mutability is localized: it manifests itself only inside the build step, and so the inputs and outputs of this build step are still immutable.

With this guideline in place, each file or directory touched by the build system only has _one_ rule that is responsible for generating it. This makes the set of build rules much simpler to understand.

::**To do**: Caching becomes simpler, too. Cache all the intermediate files and directories generated by the build steps.::

::**To do**: Another advantage is that state does not need to be tracked elsewhere: “did we already perform operation Y on this directory” becomes a nonsensical question, because operation Y would yield a new directory, and if that directory exists, then the operation has been run.::

::**To do**: The above, orrrr… there has been an error. This is especially problematic for build steps that generate directories. A better build system would be able to remove the output and re-run the necessary build steps. But for that, I think external state needs to be stored (the existence of the directory is not enough to qualify as success… unless you create the dir elsewhere and move it into place).::

::**To do**: Don’t dynamically calculate filenames. This makes it a pain to track what depends on what. Maybe not quite a related thought.::