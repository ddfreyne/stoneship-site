

    
        <meta charset="utf-8">

        <title>Build processes should only generate new files</title>

        <!-- metadata -->

        <meta name="generator" content="Nanoc 4.12.1">

        <meta property="og:site_name" content="denisdefreyne.com">

        <meta property="og:url" content="https://denisdefreyne.com/notes/nfpfv-mn9lk-vmphp/">

        <meta property="og:title" content="Build processes should only generate new files">
        <meta property="dc.title" content="Build processes should only generate new files">

        <meta property="og:type" content="website">

        

        
            <meta property="og:description" content="A note in Denis’ digital garden.">
        

        <!-- style -->

        
            <link rel="stylesheet" href="../../assets/style/reset-x474zZ4mc7j473vXXmQEP4oTpk.css">
            <link rel="stylesheet" href="../../assets/style/fonts-5jztFEOuR7ip8nFIXTZBpvsEI38.css">
        
        
        <link rel="stylesheet" href="../../assets/style/2021q1-9AMGNX4Hu13p4xVeiqcaM5Kpfh4.css">
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <!-- scripts -->

        <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>

        <!-- google analytics -->

        <script>
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-15639968-2']);
            _gaq.push(['_trackPageview']);

            (function() {
             var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
             ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
             var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();
        </script>
    
    
    
        <div class="above-footer">
            <nav class="nav">
                <ul>
                    <li><a href="../../">denisdefreyne.com</a></li>
                    <li><a href="../../software/">software</a></li>
                    <li><a href="../../talks/">talks</a></li>
                    <li><a href="../">notes</a></li>
                    <li><a href="../../cv/">cv</a></li>
                </ul>
            </nav>

            <article class="container primary">
                <h1>Build processes should only generate new&nbsp;files</h1>


<p>Steps in a build process should not modify files — neither files that are checked-in into the version control system, nor files that were generated previously in the build&nbsp;process.</p>

<p>This is essentially side-effect-free programming. Writing to disk is not a <em>side</em> effect; it is the main effect. Build step inputs and outputs are&nbsp;immutable.</p>

<p>There is one exception to this guideline: a build step can generate files and mutate them <em>in the same build step</em>. This works, because the mutability is localized: it manifests itself only inside the build step, and so the inputs and outputs of this build step are still&nbsp;immutable.</p>

<h2 id="advantages">Advantages</h2>
<p>(“Target” here means an output directory or output&nbsp;file.)</p>

<p>The set of build rules will be easier to understand, because there is only one rule for each&nbsp;target.</p>

<p>Incremental rebuilds will be faster. Previously generated output that is still up to date will not need to be regenerated. If mutation is allowed, this is not necessarily&nbsp;true.</p>

<p>State does not need to be tracked explicitly. Questions like “was operation X already performed on this target” are not trivial to answer when allowing mutation: this information needs to be tracked explicitly. When mutation is disallowed, the existence of the output file/directory is&nbsp;enough.</p>

<p>Note, however, that to avoid the need to track state explicitly, targets must be created atomically: if the target exists, it must be up to date. Targets need to be created elsewhere and then moved into place. This works as long as the move operation is be atomic (i.e., within the same&nbsp;filesystem).</p>

<h2 id="other-thoughts">Other&nbsp;thoughts</h2>
<p><mark><strong>To do</strong>: Don’t dynamically calculate filenames. This makes it a pain to track what depends on what. Maybe not quite a related thought.
</mark></p>


<div class="hr"></div>

<div class="col-left-sm main-footer muted">
  <div>Last revised:</div>
  <div class="pb-base">April 2021</div>
</div>

<div class="col-center-sm main-footer muted">
  
    <div>Backlinks:</div>
    <ul class="pb-base">
      
        <li><a href="../../now/">What’s top of mind</a></li>
      
    </ul>
  
</div>

            </article>
        </div>

        <footer class="footer muted">
            <div>© 2007–2021</div>
            <div>made in Berlin</div>
        </footer>

        <script>hljs.highlightAll();</script>
    



