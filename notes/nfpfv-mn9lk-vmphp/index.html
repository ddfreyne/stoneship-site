<!DOCTYPE html><html prefix="og: http://ogp.me/ns# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile# zotero: http://www.zotero.org/namespaces/export#" lang="en"><head>
        <meta charset="utf-8">

        <title>Build processes should only generate new files</title>

        <!-- metadata -->

        <meta name="generator" content="Nanoc 4.12.2">

        

        <meta property="og:site_name" content="denisdefreyne.com">

        <meta property="og:url" content="https://denisdefreyne.com/notes/nfpfv-mn9lk-vmphp/">

        <meta property="og:title" content="Build processes should only generate new files">
        <meta property="dc.title" content="Build processes should only generate new files">

        <meta property="og:type" content="website">

        

        
            <meta property="og:description" content="A note in Denis’ digital garden.">
        

        <link rel="preconnect" href="https://fonts.googleapis.com">
        <link href="https://fonts.googleapis.com/css2?family=Source+Sans+Pro:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Source+Serif+Pro:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=EB+Garamond:ital@0;1&amp;display=swap" rel="stylesheet">
        <link href="https://fonts.googleapis.com/css2?family=Public+Sans:ital,wght@0,400;0,700;1,400&amp;display=swap" rel="stylesheet">

        
            <link rel="stylesheet" href="../../assets/style/reset-x474zZ4mc7j473vXXmQEP4oTpk.css">
            <link rel="stylesheet" href="../../assets/fonts/main.css">
        
        
        
            <link rel="stylesheet" href="../../assets/style/util-byT6V584sYgSwWqp7s5tdeLjg.css">
        
            <link rel="stylesheet" href="../../assets/style/note-A1MWDo6LffGw54IqhOYiYflQ7E.css">
        
        <meta name="viewport" content="width=device-width, initial-scale=1">

        <link rel="alternate" type="application/atom+xml" href="../../feed.xml" title="Atom feed for denisdefreyne.com articles">

        <script>
            var _gaq = _gaq || [];
            _gaq.push(['_setAccount', 'UA-15639968-2']);
            _gaq.push(['_trackPageview']);

            (function() {
             var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
             ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
             var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
             })();
        </script>
    </head>

    
  <body><div class="py-3 px-3 pos-fixed bg-white border-b-gray-100 z-100 w-100">// <a href="../../">denisdefreyne.com</a> / <a href="../">notes</a></div>

  <div class="wrapper pt-5 pb-4">
    <div>
      <div class="sidenote text-muted pt-3">
        
          <div class="pt-2">Last revised:</div>
          <div class="pb-3">April 2021</div>
        

        
      </div>
    </div>

    <h1>Build processes should only generate new files</h1>

    
<p>Steps in a build process should not modify files — neither files that are checked-in into the version control system, nor files that were generated previously in the build&nbsp;process.</p>

<p>This is essentially side-effect-free programming. Writing to disk is not a <em>side</em> effect; it is the main effect. Build step inputs and outputs are&nbsp;immutable.</p>

<p>There is one exception to this guideline: a build step can generate files and mutate them <em>in the same build step</em>. This works, because the mutability is localized: it manifests itself only inside the build step, and so the inputs and outputs of this build step are still&nbsp;immutable.</p>

<h2 id="advantages">Advantages</h2>
<p>(“Target” here means an output directory or output&nbsp;file.)</p>

<p>The set of build rules will be easier to understand, because there is only one rule for each&nbsp;target.</p>

<p>Incremental rebuilds will be faster. Previously generated output that is still up to date will not need to be regenerated. If mutation is allowed, this is not necessarily&nbsp;true.</p>

<p>State does not need to be tracked explicitly. Questions like “was operation X already performed on this target” are not trivial to answer when allowing mutation: this information needs to be tracked explicitly. When mutation is disallowed, the existence of the output file/directory is&nbsp;enough.</p>

<p>Note, however, that to avoid the need to track state explicitly, targets must be created atomically: if the target exists, it must be up to date. Targets need to be created elsewhere and then moved into place. This works as long as the move operation is be atomic (i.e., within the same&nbsp;filesystem).</p>

<h2 id="other-thoughts">Other&nbsp;thoughts</h2>
<p><mark><strong>To do</strong>: Don’t dynamically calculate filenames. This makes it a pain to track what depends on what. Maybe not quite a related thought.
</mark></p>

  </div>


    <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/10.7.2/highlight.min.js"></script>
    <script>hljs.highlightAll();</script>


</body></html>